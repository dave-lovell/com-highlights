---
title: "Reading Census Files"
author: "Ladun"
format: html
editor: visual
---

#### libraries

```{r libs}
library(here)
library(vroom)
```

## Define important variables

### CoM names vector

Make a vector of all CoM names, based on directories in the 'com/csvs' directory

```{r makeCoMNameVecor}
## tiny-helper
what <- function(...) dir( here(...) )

com_names_vector <- what("data", "inputs", "census", "com", "csvs")
```

## Read csvs

### Create read_census_csvs function

```{r tableRead}
read_census_csvs <- function(x, address){
  
  path_csvs <- here("data", "inputs", "census", address, "csvs", x)
  path_csvs <- dir(path_csvs, full.names = TRUE)
  
  tables <- lapply(path_csvs, vroom) 
   return(tables)
}

```


### Read CoM csvs



```{r readCoMCsvs}
com_vector <- what("data", "inputs", "census", "nations", "csvs")
path_nation <- here("data", "inputs", "census", "nations", "csvs")

com_paths <- paste(path_csvs, com_names_vector, sep = "/")

com_names_list <- as.list(com_names_vector)
names(com_names_list) <- com_names_list

com_tables <- lapply(com_names_list, read_census_csvs, "com")

```

### Read Nation csvs

```{r readNationcsvs}
nation_vector <- what("data", "inputs", "census", "nations", "csvs")

path_nation_list <- as.list(nation_vector)
names(path_nation_list) <- path_nation_list

nation_tables <- lapply(path_nation_list, read_census_csvs, "nation")

```

### Read Diocese csvs

```{r readDiocesecsvs}
dioceses_vector <- what("data", "inputs", "census", "dioceses", "csvs")
path_dioceses <- here("data", "inputs", "census", "dioceses", "csvs")
path_dioceses_list <- as.list(dioceses_vector)
names(path_dioceses_list) <- path_dioceses_list

dioceses_tables <- lapply(path_dioceses_list, read_census_csvs, "dioceses")

```

## Make big list and save

```{r saveList}

overall_table <-
  list(
    com = com_tables,
    nation = nation_tables,
    dioceses = dioceses_tables
    )

# overall_table
saveRDS(
  overall_table,
  file = here("data", "intermediate", "census", "merged-data",
              "01_all-census-data_list_2022-10-12.RDS")
  )
```
